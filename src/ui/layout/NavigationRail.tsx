import * as React from "react";
import { Palette, Network, Sparkles, HelpCircle } from "lucide-react";
import { useAppSwitcher } from "@/ui/AppSwitcher";
import { NavRailItem } from "./NavRailItem";
import { HowItWorksPanel } from "../components/HowItWorksPanel";

export function NavigationRail() {
  const { activeApp, switchToApp } = useAppSwitcher();
  const [showGuide, setShowGuide] = React.useState(false);

  const navItems = [
    {
      id: "color" as const,
      icon: Palette,
      label: "Colors",
      ariaLabel: "Colors view",
    },
    {
      id: "figzig" as const,
      icon: Network,
      label: "Graph",
      ariaLabel: "Graph view",
    },
    {
      id: "automate" as const,
      icon: Sparkles,
      label: "Automate",
      ariaLabel: "Automate view",
    },
  ];

  return (
    <>
      <nav
        className="w-16 bg-background border-r border-border-subtle flex flex-col items-center py-5 gap-2"
        role="navigation"
        aria-label="Main navigation"
      >
        {/* Logo at top */}
        <div className="mb-4 flex items-center justify-center">
          <svg width="35" height="47" viewBox="0 0 35 47" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7.56445 44.7324H10.3242V46.0645H5.87207V37.6885H7.56445V44.7324ZM13.083 46.0635H11.3789V39.416H13.083V46.0635ZM18.5713 39.332C19.0751 39.3321 19.5148 39.4441 19.8906 39.668C20.2746 39.892 20.5713 40.2156 20.7793 40.6396C20.9872 41.0555 21.0908 41.5596 21.0908 42.1514V46.0635H19.4111V42.4639C19.4111 41.9359 19.2749 41.5235 19.0029 41.2275C18.7309 40.9236 18.3745 40.7715 17.9346 40.7715C17.6388 40.7715 17.3791 40.8519 17.1553 41.0117C16.9314 41.1637 16.7549 41.3756 16.627 41.6475C16.507 41.9195 16.4473 42.232 16.4473 42.584V46.0635H14.7549V39.416H16.4473V40.8193C16.5512 40.5236 16.711 40.2639 16.9268 40.04C17.1427 39.8161 17.3947 39.6434 17.6826 39.5234C17.9706 39.3954 18.2673 39.332 18.5713 39.332ZM24.3809 42.1035C24.7807 42.0235 25.1606 41.8677 25.5205 41.6357C25.8804 41.3958 26.1921 41.0878 26.4561 40.7119C26.72 40.3359 26.9048 39.904 27.0088 39.416H28.8086C28.6806 39.9279 28.4725 40.4038 28.1846 40.8438C27.9046 41.2838 27.5762 41.6681 27.2002 41.9961C26.8243 42.324 26.4323 42.5676 26.0244 42.7275C26.3364 42.8155 26.6489 42.9676 26.9609 43.1836C27.2729 43.3916 27.565 43.6482 27.8369 43.9521C28.1087 44.248 28.3403 44.5758 28.5322 44.9355C28.7242 45.2954 28.852 45.6716 28.916 46.0635H27.1162C27.0362 45.6956 26.9046 45.3633 26.7207 45.0674C26.5367 44.7635 26.3202 44.4993 26.0723 44.2754C25.8324 44.0436 25.5644 43.8558 25.2686 43.7119C24.9807 43.568 24.6847 43.4803 24.3809 43.4482V46.0635H22.6885V37.1836H24.3809V42.1035ZM12.2432 36.4639C12.5789 36.4639 12.8591 36.5677 13.083 36.7754C13.307 36.9834 13.4189 37.2399 13.4189 37.5439C13.4189 37.8479 13.307 38.1035 13.083 38.3115C12.859 38.5115 12.5791 38.6123 12.2432 38.6123C11.9073 38.6123 11.6273 38.5115 11.4033 38.3115C11.1795 38.1036 11.0674 37.8478 11.0674 37.5439C11.0674 37.2399 11.1793 36.9834 11.4033 36.7754C11.6272 36.5676 11.9074 36.4639 12.2432 36.4639ZM9.37402 27.6484C10.0139 27.6485 10.5896 27.7884 11.1016 28.0684C11.6216 28.3404 12.0339 28.7321 12.3379 29.2441C12.6418 29.7481 12.7939 30.348 12.7939 31.0439C12.7939 31.7397 12.638 32.3436 12.3262 32.8555C12.0222 33.3674 11.606 33.764 11.0781 34.0439C10.5582 34.3239 9.97406 34.4638 9.32617 34.4639C8.68617 34.4639 8.10966 34.3239 7.59766 34.0439C7.09374 33.764 6.68971 33.3674 6.38574 32.8555C6.08991 32.3436 5.94238 31.7398 5.94238 31.0439C5.94238 30.3481 6.0936 29.7481 6.39746 29.2441C6.70141 28.7322 7.11391 28.3404 7.63379 28.0684C8.15379 27.7884 8.73402 27.6484 9.37402 27.6484ZM24.1064 27.6484C24.5064 27.6484 24.8824 27.7044 25.2344 27.8164C25.5862 27.9204 25.8943 28.0716 26.1582 28.2715C26.4301 28.4634 26.6382 28.6959 26.7822 28.9678C26.9342 29.2396 27.0107 29.5357 27.0107 29.8555C27.0107 30.2715 26.8904 30.6204 26.6504 30.9004C26.4104 31.1803 26.0903 31.4043 25.6904 31.5723C25.2985 31.7322 24.8665 31.8442 24.3945 31.9082C23.9225 31.9642 23.458 31.9838 23.002 31.9678C22.93 31.9598 22.8458 31.9561 22.75 31.9561H22.4863C22.4148 31.9481 22.3669 31.9444 22.3428 31.9443C22.3908 32.1602 22.5028 32.3601 22.6787 32.5439C22.8627 32.7279 23.0867 32.8716 23.3506 32.9756C23.6145 33.0715 23.8983 33.1201 24.2021 33.1201C24.4661 33.1201 24.7227 33.0763 24.9707 32.9883C25.2186 32.9003 25.4464 32.7799 25.6543 32.6279C25.8703 32.468 26.0466 32.2963 26.1826 32.1123L27.3467 32.9883C27.0907 33.3243 26.794 33.6041 26.458 33.8281C26.1221 34.044 25.7618 34.2036 25.3779 34.3076C24.9941 34.4115 24.5945 34.4638 24.1787 34.4639C23.6667 34.4639 23.19 34.3836 22.75 34.2236C22.3182 34.0636 21.9382 33.8359 21.6104 33.54C21.2905 33.2441 21.0385 32.8922 20.8545 32.4844C20.6785 32.0684 20.5908 31.6075 20.5908 31.1035C20.5909 30.5837 20.6823 30.1114 20.8662 29.6875C21.0502 29.2636 21.3069 28.8996 21.6348 28.5957C21.9627 28.2919 22.3388 28.0603 22.7627 27.9004C23.1866 27.7324 23.6345 27.6484 24.1064 27.6484ZM6.15625 27.3721H3.92383V34.3799H2.23242V27.3721H0V26.0039H6.15625V27.3721ZM15.707 30.4199C16.1069 30.3399 16.4868 30.1841 16.8467 29.9521C17.2065 29.7122 17.5183 29.4041 17.7822 29.0283C18.0462 28.6524 18.2309 28.2203 18.335 27.7324H20.1348C20.0068 28.2443 19.7987 28.7203 19.5107 29.1602C19.2308 29.6001 18.9023 29.9836 18.5264 30.3115C18.1504 30.6395 17.7586 30.8839 17.3506 31.0439C17.6626 31.1319 17.9751 31.284 18.2871 31.5C18.599 31.708 18.8912 31.9637 19.1631 32.2676C19.4351 32.5635 19.6664 32.892 19.8584 33.252C20.0504 33.6119 20.1782 33.988 20.2422 34.3799H18.4424C18.3624 34.0119 18.2308 33.6797 18.0469 33.3838C17.8629 33.0798 17.6464 32.8158 17.3984 32.5918C17.1585 32.3599 16.8906 32.1723 16.5947 32.0283C16.3068 31.8844 16.0109 31.7957 15.707 31.7637V34.3799H14.0146V25.5H15.707V30.4199ZM32.2686 27.6484C32.7724 27.6485 33.212 27.7604 33.5879 27.9844C33.9719 28.2084 34.2686 28.5321 34.4766 28.9561C34.6845 29.372 34.7881 29.876 34.7881 30.4678V34.3799H33.1084V30.7803C33.1084 30.2523 32.9722 29.8399 32.7002 29.5439C32.4282 29.2399 32.0718 29.0879 31.6318 29.0879C31.336 29.0879 31.0764 29.1683 30.8525 29.3281C30.6286 29.4801 30.4522 29.6919 30.3242 29.9639C30.2042 30.2359 30.1445 30.5484 30.1445 30.9004V34.3799H28.4521V27.7324H30.1445V29.1357C30.2485 28.8399 30.4081 28.5794 30.624 28.3555C30.8399 28.1316 31.092 27.9598 31.3799 27.8398C31.6679 27.7118 31.9646 27.6484 32.2686 27.6484ZM9.34961 29.1123C9.05372 29.1124 8.7774 29.1842 8.52148 29.3281C8.27371 29.4641 8.07006 29.6761 7.91016 29.9639C7.75016 30.2519 7.66992 30.6119 7.66992 31.0439C7.66992 31.4758 7.74558 31.8398 7.89746 32.1357C8.04946 32.4237 8.25005 32.6402 8.49805 32.7842C8.75399 32.9201 9.03025 32.9883 9.32617 32.9883C9.62207 32.9882 9.9021 32.9201 10.166 32.7842C10.43 32.6402 10.6455 32.4237 10.8135 32.1357C10.9815 31.8397 11.0654 31.4759 11.0654 31.0439C11.0654 30.6119 10.9815 30.2519 10.8135 29.9639C10.6535 29.676 10.4417 29.4641 10.1777 29.3281C9.92175 29.1841 9.64559 29.1123 9.34961 29.1123ZM24.1543 28.9795C23.7863 28.9795 23.4579 29.0644 23.1699 29.2324C22.8903 29.4003 22.6706 29.62 22.5107 29.8916C22.3508 30.1555 22.2621 30.4318 22.2461 30.7197C22.3421 30.7277 22.4624 30.7361 22.6064 30.7441C22.7504 30.7521 22.9025 30.7559 23.0625 30.7559C23.3264 30.7559 23.5905 30.7437 23.8545 30.7197C24.1264 30.6957 24.3747 30.6519 24.5986 30.5879C24.8305 30.5159 25.0144 30.4198 25.1504 30.2998C25.2942 30.1719 25.3661 30.0121 25.3662 29.8203C25.3662 29.6604 25.3101 29.5203 25.1982 29.4004C25.0943 29.2724 24.9505 29.1716 24.7666 29.0996C24.5906 29.0196 24.3863 28.9795 24.1543 28.9795ZM20.3945 0C21.43 0.00011495 22.3139 0.365934 23.0459 1.09766C23.7779 1.82982 24.1445 2.71417 24.1445 3.75V12.0977C24.7277 12.3143 25.2071 12.6614 25.582 13.1377C25.9568 13.6139 26.1445 14.1507 26.1445 14.7471C26.1445 15.5117 25.8771 16.162 25.3428 16.6973C24.8083 17.2325 24.1589 17.4999 23.3955 17.5C22.632 17.5 21.9824 17.2324 21.4473 16.6973C20.912 16.162 20.6446 15.5118 20.6445 14.7471C20.6445 14.1506 20.832 13.6097 21.207 13.125C21.582 12.6405 22.0613 12.2976 22.6445 12.0977V3.75C22.6445 3.13117 22.4234 2.60163 21.9824 2.16113C21.5415 1.72053 21.0116 1.50007 20.3926 1.5C19.7733 1.5 19.2435 1.72048 18.8037 2.16113C18.364 2.60163 18.1445 3.13117 18.1445 3.75V13.75C18.1445 14.7858 17.7779 15.6702 17.0459 16.4023C16.3139 17.1341 15.43 17.4999 14.3945 17.5C13.3588 17.5 12.4743 17.1342 11.7422 16.4023C11.0102 15.6702 10.6445 14.7858 10.6445 13.75V5.40234C10.0612 5.18569 9.58202 4.83858 9.20703 4.3623C8.83203 3.88597 8.64453 3.34943 8.64453 2.75293C8.64461 1.98829 8.91096 1.33797 9.44531 0.802734C9.97976 0.267451 10.6292 5.02008e-05 11.3926 0C12.1561 0 12.8057 0.267564 13.3408 0.802734C13.8761 1.33799 14.1445 1.98824 14.1445 2.75293C14.1445 3.34928 13.9568 3.88606 13.582 4.3623C13.2071 4.83855 12.7277 5.18567 12.1445 5.40234V13.75C12.1445 14.3688 12.3647 14.8984 12.8057 15.3389C13.2466 15.7795 13.7765 15.9999 14.3955 16C15.0148 16 15.5445 15.7795 15.9844 15.3389C16.424 14.8984 16.6445 14.3688 16.6445 13.75V3.75C16.6445 2.71417 17.0102 1.82982 17.7422 1.09766C18.4743 0.365819 19.3588 0 20.3945 0Z" fill="white"/>
          </svg>
        </div>
        
        {navItems.map((item) => {
          const isActive = activeApp === item.id;
          
          return (
            <NavRailItem
              key={item.id}
              icon={item.icon}
              label={item.label}
              isActive={isActive}
              ariaLabel={item.ariaLabel}
              onClick={() => switchToApp(item.id)}
            />
          );
        })}
        
        {/* Spacer to push guide to bottom */}
        <div className="flex-1" />
        
        {/* How it Works/Guide at bottom */}
        <NavRailItem
          icon={HelpCircle}
          label="Guide"
          isActive={showGuide}
          ariaLabel="How it works guide"
          onClick={() => setShowGuide(!showGuide)}
        />
      </nav>
      
      {/* How It Works Panel */}
      <HowItWorksPanel isOpen={showGuide} onClose={() => setShowGuide(false)} />
    </>
  );
}
